window.require = (function () {
	"use strict";
	var ROOT = location.origin + location.pathname.replace(/[^/]*\.[^/]+$/, ''); // cache against history.pushState mutation
	var REQUIRE_CACHE = Object.create(null);
	var hasOwn = ({}).hasOwnProperty;
	var RE_URL = /^\w+:\/\/.+/;

	function require (url) {
		var fqn = _GenerateFQN_(url, this.__dirname);
		if (fqn in REQUIRE_CACHE) {
			return REQUIRE_CACHE[fqn].exports;
		}
		var MODULE_CODE = _ImportCode_(fqn.abs);
		if (fqn.abs.endsWith('.json')) {
			return (REQUIRE_CACHE[fqn] = {exports: JSON.parse(MODULE_CODE)}).exports;
		}
		var MODULE_EXECUTABLE = Function('module', 'exports', '__dirname', 'require', MODULE_CODE + '\n\n//# sourceURL=' + fqn.abs);
		var MODULE__module = {
			__dirname: fqn.dir,
			exports: {}
		};
		REQUIRE_CACHE[fqn] = MODULE__module;
		MODULE_EXECUTABLE.call(MODULE__module.exports, MODULE__module, MODULE__module.exports, fqn.dir, require.bind(MODULE__module));
		return MODULE__module.exports;
	}

	function _ImportCode_ (url) {
		var xhr = new XMLHttpRequest();
		xhr.open('GET', url, false);
		xhr.send();
		if (xhr.status !== 200) {
			throw Error('Unable to load module ' + url);
		}
		return xhr.response;
	}

	function _GenerateFQN_ (url, __dirname) {
		var fqn = {
			toString: function () {
				return this.abs;
			}
		};
		fqn.abs = new URL(url.match(RE_URL) ? url : ((url.startsWith('/') ? ROOT : __dirname) + url)).href;
		fqn.dir = fqn.abs.split('/').slice(0, -1).join('/') + '/';
		return fqn;
	}

	return require.bind({__dirname: ROOT});

})();